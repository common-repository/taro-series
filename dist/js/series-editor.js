/*! License information can be found in series-editor.js.LICENSE.txt */
!function(){const{Component:e,render:t}=wp.element,{__:__,sprintf:sprintf}=wp.i18n,{Spinner:s,Button:a,Modal:r,TextControl:i}=wp.components,{apiFetch:l}=wp,{dispatch:n}=wp.data,o=(e,t)=>{n("core/notices").createNotice(t,e,{type:"snackbar",isDismissible:!0,explicitDismiss:!1})},c={borderBottom:"1px solid #ddd",padding:"10px"},d={display:"inline-block",padding:"2px 3px",backgroundColor:"#eee",marginLeft:"10px",borderRadius:"3px"},m={marginRight:"10px"};class p extends e{constructor(e){super(e),this.state={loading:!1}}add(e){this.setState({loading:!0},(()=>{l({path:`taro-series/v1/series/${this.props.seriesId}`,method:"post",data:{post_id:e.id}}).then((()=>{this.props.onAdd(e)})).catch((e=>{o(e.message,"error")})).finally((()=>{this.setState({loading:!1})}))}))}render(){const{loading:e}=this.state,{post:t}=this.props;return React.createElement("li",{className:"clearfix",style:{borderBottom:"1px solid #eee",padding:"10px"}},React.createElement(a,{style:{float:"right"},isDefault:!0,isSmall:!0,isBusy:e,onClick:()=>{this.add(t)}},__("Add","taro-series")),React.createElement("p",null,React.createElement("strong",null,t.title),React.createElement("small",{style:d},t.postTypeLabel),React.createElement("small",{style:d},t.dateFormatted)))}}class h extends e{constructor(e){super(e),this.state={posts:[],loading:!0,results:[],resultCount:0,searching:!1,term:""}}componentDidMount(){this.setState({loading:!0},(()=>{l({path:`taro-series/v1/series/${this.props.seriesId}`,method:"get"}).then((e=>{this.setState({loading:!1,posts:e.posts})})).catch((()=>{this.setState({loading:!1,posts:[]})}))}))}search(){this.setState({loading:!0},(()=>{l({path:`taro-series/v1/series/${this.props.seriesId}?s=${this.state.term}`,method:"get"}).then((e=>{this.setState({loading:!1,resultCount:e.total,results:e.posts})})).catch((e=>{this.setState({loading:!1,results:[],resultCount:0},(()=>{o(e.message,"error")}))}))}))}add(e){const{posts:t}=this.state;t.push(e),t.sort(((e,t)=>e.date===t.date?0:e.date<t.date?-1:1)),this.setState({posts:t})}remove(e){this.setState({loading:!1},(()=>{l({path:`taro-series/v1/series/${this.props.seriesId}?post_id=${e}`,method:"delete"}).then((()=>{this.setState({loading:!1,posts:this.state.posts.filter((t=>t.id!==e))},(()=>{
// translators: %d is post id.
o(sprintf(__("#%d is removed from the articles of this series.","taro-series"),e),"success")}))})).catch((e=>{this.setState({loading:!1},(()=>{o(e.message,"error")}))}))}))}finishSearch(){this.setState({searching:!1,results:[],resultCount:0,term:""})}render(){const{searching:e,loading:t,posts:l,results:n,term:o,resultCount:h}=this.state;return React.createElement(React.Fragment,null,t&&React.createElement(React.Fragment,null,React.createElement(s,null),React.createElement("p",{className:"description"},__("Loadingâ€¦","taro-series"))),!t&&0<l.length&&React.createElement("ol",{className:"taro-series-list",style:{margin:"0 0 20px"}},l.map((e=>React.createElement("li",{style:c,className:"taro-series-item",key:e.id},React.createElement("p",{className:"taro-series-item-title"},React.createElement("strong",null,e.title),React.createElement("small",{style:d},e.statusLabel),React.createElement("small",{style:d},e.postTypeLabel),React.createElement("small",{style:d},e.dateFormatted)),React.createElement("p",null,React.createElement("a",{style:m,className:"components-button is-small is-tertiary",href:e.editLink,target:"_blank",rel:"noopener noreferrer"},__("Edit","taro-series")),React.createElement("a",{style:m,className:"components-button is-small is-tertiary",href:e.link,target:"_blank",rel:"noopener noreferrer"},__("View","taro-series")),React.createElement(a,{isDestructive:!0,isSmall:!0,isTertiary:!0,onClick:()=>{this.remove(e.id)}},__("Remove from this series","taro-series"))))))),!t&&1>l.length&&React.createElement(React.Fragment,null,React.createElement("p",{className:"description"},__("No post is assigned in this series.","taro-series")),React.createElement("hr",{style:{margin:"10px 0"}})),React.createElement(a,{isDefault:!0,isBusy:e,onClick:()=>{this.setState({searching:!0})}},__("Add New Article","taro-series")),e&&React.createElement(r,{title:__("Add Article","taro-series"),onRequestClose:()=>this.finishSearch()},React.createElement(i,{value:o,onChange:e=>this.setState({term:e}),placeholder:__("Type and search.","taro-series")}),React.createElement(a,{isDefault:!0,onClick:()=>this.search()},__("Search","taro-series")),React.createElement("hr",{style:{margin:"10px 0"}}),t&&React.createElement(s,null),0<n.length?React.createElement(React.Fragment,null,React.createElement("p",null,/* translators: %d is post count. */sprintf(__("Found posts: %d","taro-series"),h)),React.createElement("ol",{style:{borderTop:"1px solid #eee"}},n.map((e=>React.createElement(p,{post:e,key:`search-${e.id}`,seriesId:this.props.seriesId,onAdd:e=>this.add(e)}))))):React.createElement("p",{className:"description"},__("No post matches criteria. Type keyword and try search.","taro-series"))))}}const u=document.getElementById("series-articles");u&&t(React.createElement(h,{seriesId:u.dataset.postId}),u)}();